#!/usr/bin/env node
/*eslint-disable */

var path = require('path');
var commander = require('commander');
var hashFiles = require(path.resolve(__dirname, '../lib/utils/hashFiles'));

function parseBool(v) {
  return v === 'true' || v === '1' ? true : false;
}

commander
  .version('0.9.0')
  .usage('[options] [...path]')
  .option('-a, --algorithm <name>', 'hash algorithm (default md5)')
  .option('-r, --root <path>', 'JSON root path')
  .parse(process.argv);

var paths;

if (commander.args.length > 0) {
  paths = commander.args.map(function(p) {
    return path.resolve(process.cwd(), p);
  });
} else {
  paths = [process.cwd()];
}

hashFiles(process.cwd(), paths, commander.algorithm, commander.root)
  .then(function(json) {
    process.stdout.write(JSON.stringify(json, null, '\t') + '\n');
    process.exit(0);
  })
  .catch(function(err) {
    process.stderr.write(err.message + '\n');
    process.exit(1);
  });
