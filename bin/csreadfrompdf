#!/usr/bin/env node
/*eslint-disable */

var path = require('path');
var commander = require('commander');
var readPackageSync = require(path.resolve(
  __dirname,
  '../lib/utils/readPackageSync'
));
var readFromPDF = require(path.resolve(__dirname, '../lib/utils/readFromPDF'));

function handleOutput(output) {
  var str = JSON.stringify(output, null, '\t') + '\n';
  var res = process.stdout.write(str, function() {
    process.exit(0);
  });

  if (!res) {
    handleError(new Error('Failed to write output'));
  }
}

function handleError(err) {
  process.stderr.write(err.message + '\n', function() {
    process.exit(1);
  });
}

commander
  .version(readPackageSync('version'))
  .usage('[options] input')
  .parse(process.argv);

if (commander.args.length !== 1) {
  commander.outputHelp();
  process.exit(1);
}

try {
  readFromPDF(path.resolve(process.cwd(), commander.args[0]))
    .then(handleOutput)
    .catch(handleError);
} catch(err) {
  handleError(err);
}
